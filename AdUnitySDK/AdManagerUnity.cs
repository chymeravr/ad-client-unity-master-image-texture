//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.18408
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using System;
using System.Collections;
using UnityEngine;
using UnityEngine.VR;
using co.chimeralabs.ads.managed;

namespace ChimeraVirtualAds
{
	public static class AdManagerUnity
	{
		private static Hashtable adUnits = new Hashtable();
		private static Hashtable adInstances = new Hashtable ();
		private static Hashtable instancesByUnits = new Hashtable ();
		private static Boolean isStartupDone = false;
		private static Boolean isShutdownDone = false;
		public static void Startup(String appId){
			if (!isStartupDone) {
				isStartupDone = true;
				AdConfigurer.SetAppId(appId);
				AdConfigurer.Startup (new PlatformPCWindowsImpl());
				PlatformObjectsFactoryHolder.SetFactory (new PlatformObjectsFactoryUnity ());
			}
		}
		public static void Shutdown(){
			if (!isShutdownDone) {
				isShutdownDone = true;
				AdConfigurer.Shutdown ();
			}
		}
		public static void RegisterImageTextureAdUnit(ImageTextureAdInstanceUnity instance, int nDistinctAds){
			if (adInstances [instance.GetAdInstanceId ()] == null) {
				adInstances.Add(instance.GetAdInstanceId(), instance);
				if(instancesByUnits[instance.GetAdUnitId()] == null) {
					instancesByUnits.Add(instance.GetAdUnitId(), new ArrayList());
				}
				((ArrayList)instancesByUnits[instance.GetAdUnitId()]).Add(instance.GetAdInstanceId());
			} else { //duplicate adinstanceid
			}
			if (adUnits [instance.GetAdUnitId()] == null) {
				ImageTextureAdUnitListener listener = new ImageTextureAdUnitListener();
				ImageTextureAdUnit adUnit = new ImageTextureAdUnit(listener, instance.GetAdUnitId());
				adUnits.Add(instance.GetAdUnitId(), adUnit);
				adUnit.LoadAds (nDistinctAds);
			}
		}
		public static ArrayList GetInstanceIdsByAdUnitId(String adUnitId){
			return (ArrayList)instancesByUnits [adUnitId];
		}
		public static Hashtable GetAdUnitsHashTable(){
			return adUnits;
		}
		public static ImageTextureAdInstanceUnity GetImageTextureAdInstanceUnity(String adInstanceId){
			return (ImageTextureAdInstanceUnity)adInstances [adInstanceId];
		}
	}
	public class ImageTextureAdUnitListener : AdUnitListener
	{
		public void OnAdUnitLoadFailed(AdUnitFailedArgs args)
		{
			ArrayList instanceIds = AdManagerUnity.GetInstanceIdsByAdUnitId (args.adUnitId);
			foreach (String instanceId in instanceIds) {
				ImageTextureAdInstanceUnity instance = AdManagerUnity.GetImageTextureAdInstanceUnity(instanceId);
				instance.CallOnAdUnitLoadFailed(args);
			}
		}
		public void OnAdUnitLoaded(System.Object context)
		{
			//AdManager.GetAdsLoaded ().Add ( ((ImageTextureAdUnit)context).GetAdUnitId() , true);
			ImageTextureAdUnit adUnit = (ImageTextureAdUnit)context;
			ArrayList instanceIds = AdManagerUnity.GetInstanceIdsByAdUnitId (adUnit.GetAdUnitId());
			foreach (String instanceId in instanceIds) {
				ImageTextureAdInstanceUnity instance = AdManagerUnity.GetImageTextureAdInstanceUnity(instanceId);
				instance.SetInstance(adUnit.CreateInstance(instance.GetAdInstanceId(), instance.GetAdObject()));
				instance.CallOnAdUnitLoaded();
			}
		}
	}
}

